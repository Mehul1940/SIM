{% extends 'base.html' %}

{% block content %}
<div class="container py-5">
    <!-- Header Section -->
    <div class="text-center mb-5">
        <h2 class="display-5 fw-bold mb-3">
            <i class="fas fa-sim-card text-primary me-2"></i> Assignment Details
        </h2>
        <div class="d-flex gap-2 justify-content-center">
            <a href="{% url 'assignment_update' assignment.pk %}" 
               class="btn btn-outline-secondary btn-lg px-4 ">
                <i class="fas fa-edit me-2"></i> Edit
            </a>
            <a href="{% url 'assignment_delete' assignment.pk %}" 
               class="btn btn-outline-danger btn-lg px-4 ml-2">
                <i class="fas fa-trash-alt me-2"></i> Delete
            </a>
        </div>
    </div>

    <div class="row justify-content-center g-4">
        <!-- Left Column - Details Card -->
        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <dl class="mb-0">
                                <dt class="text-muted small">SIM Number</dt>
                                <dd class="fw-bold fs-5 mb-3">{{ assignment.sim_card.sim_number }}</dd>
                                
                                <dt class="text-muted small">Customer</dt>
                                <dd class="fw-bold mb-3">{{ assignment.customer.full_name }}</dd>
                                
                                <dt class="text-muted small">Assigned By</dt>
                                <dd class="text-primary mb-3">{{ assignment.assigned_by.username }}</dd>
                            </dl>
                        </div>
                        
                        <div class="col-md-6">
                            <dl class="mb-0">
                                <dt class="text-muted small">Activation Date</dt>
                                <dd class="fw-bold mb-3">{{ assignment.activation_date|date:"M d, Y" }}</dd>
                                
                                <dt class="text-muted small">Expiry Date</dt>
                                <dd class="fw-bold mb-3">{{ assignment.expiry_date|date:"M d, Y"|default:"-" }}</dd>
                                
                                <dt class="text-muted small">Status</dt>
                                <dd class="mb-3">
                                    <span class=" text-white badge  bg-{% if assignment.is_active %}success{% else %}danger{% endif %}">
                                        {{ assignment.is_active|yesno:"Active,Inactive" }}
                                    </span>
                                </dd>
                            </dl>
                        </div>
                    </div>

                    <hr>

                    <div class="row">
                        <div class="col-12">
                            <dt class="text-muted small">Reason</dt>
                            <dd class="mb-3">{{ assignment.reason|default:"-" }}</dd>
                            
                            <dt class="text-muted small">Notes</dt>
                            <dd>{{ assignment.notes|default:"-" }}</dd>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-0">
                    <div class="d-flex justify-content-between text-muted small">
                        <div>
                            <i class="fas fa-clock me-1"></i>
                            Created {{ assignment.created_at|timesince }} ago
                        </div>
                        <div>
                            <i class="fas fa-sync-alt me-1"></i>
                            Updated {{ assignment.updated_at|timesince }} ago
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column - Change History -->
        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-body">
                    <h4 class="h5 fw-bold mb-4">
                        <i class="fas fa-history me-2"></i> Change History
                    </h4>
                    
                    {% if history %}
                        <div class="timeline">
                            {% for record in history %}
                            <div class="timeline-item {% if record.change_type == 'Created' %}timeline-item-success{% else %}timeline-item-info{% endif %}">
                                <div class="timeline-point"></div>
                                <div class="timeline-content">
                                    <div class="d-flex justify-content-between mb-1">
                                        <span class="fw-semibold">{{ record.changed_by.username }}</span>
                                        <small class="text-muted">{{ record.changed_at|date:"M d, Y H:i" }}</small>
                                    </div>
                                    <div class="d-flex align-items-center gap-2 mb-2">
                                        <span class="text-white badge bg-{% if record.change_type == 'Created' %}success{% else %}info{% endif %}">
                                            {{ record.change_type }}
                                        </span>
                                        <code class="text-muted small">{{ record.change_details }}</code>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="alert alert-info mb-0">
                            <i class="fas fa-info-circle me-2"></i>
                            No history available
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.timeline {
    position: relative;
    padding-left: 40px;
}

.timeline-item {
    position: relative;
    padding-bottom: 20px;
}

.timeline-point {
    position: absolute;
    left: -24px;
    top: 4px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: currentColor;
}

.timeline-content {
    border-left: 2px solid #dee2e6;
    padding-left: 20px;
    padding-bottom: 20px;
}

.timeline-item-success .timeline-point {
    color: #198754;
}

.timeline-item-info .timeline-point {
    color: #0dcaf0;
}

.timeline-item:last-child .timeline-content {
    border-left-color: transparent;
    padding-bottom: 0;
}
</style>
{% endblock %}